services:
    wiremock:
      image: wiremock/wiremock:3.13.2
      container_name: wiremock
      command:
        - --port
        - "8888"
        - --verbose
      ports:
        - '8888:8888'
      networks:
        - stack
    jahia:
        image: '${JAHIA_IMAGE}'
        container_name: jahia
        depends_on:
            - wiremock
        ports:
            - '8080:8080'
            - '8000:8000'
        environment:
            - SUPER_USER_PASSWORD=${SUPER_USER_PASSWORD}
            - JAHIA_LICENSE=${JAHIA_LICENSE}
            - JPDA=true
            - WIREMOCK_URL=http://wiremock:8888
        extra_hosts:
            - jahia:127.0.0.1
        networks:
            - stack
    # Cypress container
    cypress:
        image: '${TESTS_IMAGE}'
        # https://github.com/cypress-io/cypress/issues/350
        ipc: host
        container_name: cypress
        depends_on:
            - jahia
        environment:
            - MANIFEST=${MANIFEST}
            - SUPER_USER_PASSWORD=${SUPER_USER_PASSWORD}
            - JAHIA_URL=http://jahia:8080
            - WIREMOCK_URL=http://wiremock:8888
            - NEXUS_USERNAME=${NEXUS_USERNAME}
            - NEXUS_PASSWORD=${NEXUS_PASSWORD}
        networks:
            - stack
networks:
    stack:
