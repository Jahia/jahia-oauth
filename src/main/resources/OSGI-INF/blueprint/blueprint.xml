<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd">

    <bean id="jahiaOAuthServiceImpl" class="org.jahia.modules.jahiaoauth.impl.JahiaOAuthServiceImpl">
        <property name="oAuthDefaultApi20Map">
            <map>
                <entry key="LinkedInApi20">
                    <bean class="com.github.scribejava.apis.LinkedInApi20"/>
                </entry>
                <entry key="VkontakteApi">
                    <bean class="com.github.scribejava.apis.VkontakteApi"/>
                </entry>
                <entry key="HHApi">
                    <bean class="com.github.scribejava.apis.HHApi"/>
                </entry>
                <entry key="GitHubApi">
                    <bean class="com.github.scribejava.apis.GitHubApi"/>
                </entry>
                <entry key="MailruApi">
                    <bean class="com.github.scribejava.apis.MailruApi"/>
                </entry>
                <entry key="GeniusApi">
                    <bean class="com.github.scribejava.apis.GeniusApi"/>
                </entry>
                <entry key="Foursquare2Api">
                    <bean class="com.github.scribejava.apis.Foursquare2Api"/>
                </entry>
                <entry key="RenrenApi">
                    <bean class="com.github.scribejava.apis.RenrenApi"/>
                </entry>
                <entry key="KaixinApi20">
                    <bean class="com.github.scribejava.apis.KaixinApi20"/>
                </entry>
                <!--<entry key="SalesforceApi">-->
                <!--<bean class="com.github.scribejava.apis.SalesforceApi"/>-->
                <!--</entry>-->
                <entry key="ViadeoApi">
                    <bean class="com.github.scribejava.apis.ViadeoApi"/>
                </entry>
                <entry key="GoogleApi20">
                    <bean class="com.github.scribejava.apis.GoogleApi20"/>
                </entry>
                <entry key="PinterestApi">
                    <bean class="com.github.scribejava.apis.PinterestApi"/>
                </entry>
                <entry key="SinaWeiboApi20">
                    <bean class="com.github.scribejava.apis.SinaWeiboApi20"/>
                </entry>
                <entry key="OdnoklassnikiApi">
                    <bean class="com.github.scribejava.apis.OdnoklassnikiApi"/>
                </entry>
                <entry key="FacebookApi">
                    <bean class="com.github.scribejava.apis.FacebookApi">
                        <argument value="7.0"/>
                    </bean>
                </entry>
                <entry key="TutByApi">
                    <bean class="com.github.scribejava.apis.TutByApi"/>
                </entry>
                <entry key="LiveApi">
                    <bean class="com.github.scribejava.apis.LiveApi"/>
                </entry>
                <entry key="DoktornaraboteApi">
                    <bean class="com.github.scribejava.apis.DoktornaraboteApi"/>
                </entry>
                <entry key="NaverApi">
                    <bean class="com.github.scribejava.apis.NaverApi"/>
                </entry>
                <entry key="MisfitApi">
                    <bean class="com.github.scribejava.apis.MisfitApi"/>
                </entry>
                <entry key="StackExchangeApi">
                    <bean class="com.github.scribejava.apis.StackExchangeApi"/>
                </entry>
                <entry key="ImgurApi">
                    <bean class="com.github.scribejava.apis.ImgurApi"/>
                </entry>
                <entry key="FranceConnectApi">
                    <bean class="org.jahia.modules.scribejava.apis.FranceConnectApi"/>
                </entry>
            </map>
        </property>
        <property name="jahiaOAuthCacheService" ref="jahiaOAuthCacheServiceImpl"/>
        <property name="jcrTemplate" ref="jcrTemplate"/>
    </bean>

    <reference id="jcrTemplate" interface="org.jahia.api.content.JCRTemplate" availability="mandatory"/>
    <reference id="settingsBean" interface="org.jahia.api.settings.SettingsBean"/>
    <reference id="ehCacheProvider" interface="org.jahia.services.cache.CacheProvider"/>
    <reference id="JahiaTemplateManagerService" interface="org.jahia.api.templates.JahiaTemplateManagerService"/>
    <reference id="JahiaUserManagerService" interface="org.jahia.api.usermanager.JahiaUserManagerService" availability="mandatory"/>
    <reference id="authPipeline" interface="org.jahia.pipelines.Pipeline" filter="(type=authentication)"/>

    <service id="JahiaOAuthServiceOsgi" ref="jahiaOAuthServiceImpl"
             interface="org.jahia.modules.jahiaoauth.service.JahiaOAuthService"/>
    <service id="JahiaOAuthCacheServiceOsgi" ref="jahiaOAuthCacheServiceImpl"
             interface="org.jahia.modules.jahiaoauth.service.JahiaOAuthCacheService"/>

    <service interface="org.jahia.bin.Action">
        <bean class="org.jahia.modules.jahiaoauth.action.ManageConnectorsSettings">
            <property name="name" value="manageConnectorsSettingsAction"/>
            <property name="requiredMethods" value="GET,POST"/>
            <property name="requiredPermission" value="canSetupJahiaOAuth"/>
        </bean>
    </service>

    <service interface="org.jahia.bin.Action">
        <bean class="org.jahia.modules.jahiaoauth.action.ManageMappers">
            <property name="name" value="manageMappersAction"/>
            <property name="requiredPermission" value="canSetupJahiaOAuth"/>
            <property name="jahiaOAuthService" ref="jahiaOAuthServiceImpl"/>
        </bean>
    </service>

    <bean id="joaEHCacheManager" class="org.jahia.modules.jahiaoauth.impl.cache.EHCacheManagerImpl" init-method="init"
          destroy-method="destroy">
        <property name="ehCacheProvider" ref="ehCacheProvider"/>
    </bean>

    <bean id="jahiaOAuthCacheServiceImpl" class="org.jahia.modules.jahiaoauth.impl.cache.JahiaOAuthCacheServiceImpl"
          init-method="init" destroy-method="destroy">
        <property name="defaultCacheService" ref="joaEHCacheManager"/>
        <property name="settingsBean" ref="settingsBean"/>
        <property name="bundleContext" ref="blueprintBundleContext"/>
    </bean>

    <bean class="org.jahia.modules.jahiaoauth.tag.JahiaOAuthFunctions">
        <property name="jahiaTemplateManagerService" ref="JahiaTemplateManagerService"/>
    </bean>

    <bean id="ssoValve" class="org.jahia.modules.jahiaoauth.valves.SSOValve" init-method="start" destroy-method="stop">
        <property name="jahiaOAuthCacheService" ref="jahiaOAuthCacheServiceImpl"/>
        <property name="jahiaUserManagerService" ref="JahiaUserManagerService"/>
        <property name="settingsBean" ref="settingsBean"/>
        <property name="authPipeline" ref="authPipeline"/>
    </bean>


</blueprint>
